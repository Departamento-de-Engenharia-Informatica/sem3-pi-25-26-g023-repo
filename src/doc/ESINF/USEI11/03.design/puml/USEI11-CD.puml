@startuml ClassDiagram

title USEI11 - Class Diagram

hide method
skinparam packageStyle rectangle
skinparam shadowing false
skinparam linetype polyline
skinparam classAttributeIconSize 0

class StationSpatialQueryUI {
  ' Handles user interaction for spatial queries
}

class StationSpatialQueryController {
  ' Coordinates spatial search requests
}

class StationIndexManager {
  ' Holds the spatial index (from USEI07)
  - spatialIndex: TwoDTree
}

class EuropeanStation {
  - stationName: String
  - latitude: double
  - longitude: double
  - country: String
  - isCity: boolean
}

' Index from USEI07
class TwoDTree {
}

' Result Tree (AC3)
class AVLTree<StationDistanceResult> {
}

' DTO for sorted results (AC4)
' Implements Comparable to sort by dist ASC, name DESC
class StationDistanceResult {
  - distance: double
  - station: EuropeanStation
}

' DTO for summary (AC5)
class DensitySummary {
  - countsByCountry: Map
  - countsByIsCity: Map
}

' Helper for distance (AC1)
class HaversineCalculator {
}

' Relationships
StationSpatialQueryUI ..> StationSpatialQueryController : uses

StationSpatialQueryController --> StationIndexManager : uses 1

' Manager holds the 2D-Tree built in USEI07
StationIndexManager "1" *-- "1" TwoDTree : composes
TwoDTree o-- "0..*" EuropeanStation : indexes

' Manager uses the calculator
StationIndexManager ..> HaversineCalculator : uses

' The manager creates these DTOs and the result tree
StationIndexManager ..> StationDistanceResult : creates
StationIndexManager ..> DensitySummary : creates
StationIndexManager ..> AVLTree : creates

' The result tree stores the sorted DTOs
AVLTree o-- "0..*" StationDistanceResult : stores
StationDistanceResult "1" -- "1" EuropeanStation : references

@enduml