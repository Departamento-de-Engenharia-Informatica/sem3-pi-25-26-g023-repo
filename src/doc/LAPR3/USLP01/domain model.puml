@startuml
'https://plantuml.com/class-diagram

' --- GERAL SETTINGS ---
skinparam monochrome true
skinparam shadowing true
skinparam linetype polyline
skinparam classAttributeIconSize 0
hide empty methods
hide circles

' --- DOMAIN MODEL - CLASSES PURAS (Agrupamentos removidos para evitar erro) ---

    class RailwayNetwork {
        name
    }
    class RailwayLine {
        lineId
        name
    }
    class LineSegment {
        segmentId
        gauge
        isElectrified
        length_km
        maxSpeed_kmh
        maxWeight_kg_m
        trackType
        startFacilityId : int
        endFacilityId : int
    }
    class Station {
        stationId
        name
        type
        latitude
        longitude
        hasWarehouse
        hasRefrigerated
    }
    abstract class Facility {
        name
        facilityId : int
    }
    class FreightYard {
        typeOfCargo
    }
    class Terminal {
        type
    }
    class Siding {
        purpose
    }
    abstract class Building {}
    class RefrigeratedArea {}
    class GrainSilo {}

    Facility <|-- Station
    Facility <|-- FreightYard
    Facility <|-- Terminal
    Facility <|-- Siding

    Building <|-- RefrigeratedArea
    Building <|-- GrainSilo

    RailwayNetwork "1" -- "1..*" RailwayLine : "is composed of"
    RailwayLine "1" -- "1..*" LineSegment : "is composed of"
    RailwayNetwork "1" -- "2..*" Station : connects >

    Station "1" -- "0..*" RefrigeratedArea : "can have"
    Station "1" -- "0..*" GrainSilo : "can have"

    class TrainOperator {
        id
        name
    }
    class LineOwner {
        id
        name
    }
    abstract class RollingStock {
        stockId
        make
        model
        yearOfService
        gauge
        length_m
        tareWeight_kg
    }
    class Locomotive {
        locomotiveType
        power_kw
        acceleration
        maxTotalWeight_kg
        fuelCapacity_L (diesel)
        voltage_V (electric)
        frequency_Hz (electric)
    }
    class Wagon {
        wagonType
        payloadCapacity_kg
        volumeCapacity_m3
        isRefrigerated
        maxPressure_bar (for tank)
        containerSupported
    }

    RollingStock <|-- Locomotive
    RollingStock <|-- Wagon
    TrainOperator "1" -- "0..*" RollingStock : owns
    LineOwner "1" -- "0..*" RailwayLine : owns

    class Freight {
        freightId
        status
    }

    class PlannedRoute {
        routeId
        name
        totalDistance
    }

    class RouteStop {
        sequenceNumber
        isStop (Y/N)
    }

    class TrainTrip {
        journeyId
        startDateTime
        status
    }

    class TrainEvent {
        timestamp
        eventType (arrival, departure)
    }

    TrainTrip "1" -- "1" PlannedRoute : follows >
    TrainTrip "1" -- "1..*" TrainEvent : records >

    class Warehouse extends Building {
        warehouseId
        name
    }
    class Aisle {
        aisleId
    }
    class Bay {
        bayId
        capacityBoxes
    }
    class Box {
        boxId
        sku
        qtyAvailable
        expiryDate
        receivedAt
        aisle : int
        bay : int
    }
    class Item {
        sku
        name
        category
        unitWeight
    }
    class CustomerOrder {
        orderId
        priority
        dueDate
    }
    class OrderLine {
        lineNo
        requestedQty
    }
    class Return {
        returnId
        reason
        timestamp
        isRestockable()
    }
    class Quarantine {
        stack<Return>
        LIFO_processing()
    }

    Warehouse "1" -- "1..*" Aisle : has >
    Aisle "1" -- "1..*" Bay : has >
    Bay "1" -- "0..*" Box : stores >
    Box "*" -- "1" Item : contains >
    CustomerOrder "1" -- "1..*" OrderLine : "is composed of"
    OrderLine "*" -- "1" Item : requests >
    Return "*" -- "1" Item : concerns >
    Quarantine "1" -- "0..*" Return : holds >

    class StationMngtSystem {
        manageStation()
    }
    class Track {
        trackNumber (1-99)
    }
    class StationLog {
        timestamp
        message
    }

    StationMngtSystem "1" -- "1" StationLog : writes to >

    class StationIndex {
        searchByArea()
        searchByRadius()
        searchNearestN()
    }
    class EuropeanStationDataset {
        (64k records)
    }
    class "BST/AVL" as TreeIndex
    class "2DTree" as SpatialIndex

    StationIndex "1" -- "1" EuropeanStationDataset : is built from >
    StationIndex "1" -- "*" TreeIndex : uses >
    StationIndex "1" -- "1" SpatialIndex : uses >

' --- GLOBAL RELATIONSHIPS ---

Station "1" -- "0..*" Warehouse : "can have"

RouteStop "1" -- "1" Station : "is at"
RouteStop "1" -- "1" LineSegment : "is reached via"
TrainEvent "1" -- "1" Station : "occurs at"

StationMngtSystem "1" -- "1" Station : manages >
Station "1" -- "1..99" Track : has >

TrainTrip "1" -- "1..*" Locomotive : "is pulled by"
Freight "1" -- "1..*" Wagon : "is composed of"

@enduml